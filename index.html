<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Structure Viewer - Simple</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #ui-overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 999;
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            max-width: 280px;
            border: 3px solid #ffffff;
            font-weight: bold;
        }
        
        .control-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-buttons button {
            padding: 12px 16px;
            background: rgba(0, 150, 255, 0.9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 120px;
            transition: all 0.3s;
        }
        
        .control-buttons button:hover {
            background: rgba(0, 180, 255, 1);
            transform: scale(1.05);
        }
        
        .control-buttons button:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        
        .control-buttons button.primary {
            background: rgba(0, 200, 100, 0.9);
        }
        
        .control-buttons button.primary:hover {
            background: rgba(0, 255, 120, 1);
        }
        
        .control-buttons button.danger {
            background: rgba(255, 80, 80, 0.9);
        }
        
        .control-buttons button.danger:hover {
            background: rgba(255, 100, 100, 1);
        }

        #instructions {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff88;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            text-align: center;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <h3 style="margin: 0 0 10px 0; color: #ffffff;">üî• DEBUG MODE</h3>
        <div>üìä A-Frame: <span id="aframe-status">Cargando...</span></div>
        <div>üì± Navegador: <span id="browser-info">Detectando...</span></div>
        <div>üè¢ Estructura: <span id="structure-status">No generada</span></div>
        <div>‚ö†Ô∏è Errores: <span id="error-count">0</span></div>
        <div style="margin-top: 10px; font-size: 12px;">
            Si ves esto, la p√°gina S√ç carga
        </div>
    </div>

    <!-- Instructions -->
    <div id="instructions">
        üéÆ Usa WASD para moverte | üñ±Ô∏è Arrastra para girar la vista
    </div>

    <!-- Control Buttons -->
    <div class="control-buttons">
        <button id="test-btn" class="primary">üß™ TEST B√ÅSICO</button>
        <button id="spawn-btn">üèóÔ∏è Generar</button>
        <button id="info-btn">üì± Info Device</button>
    </div>

    <!-- A-Frame Scene - Simple como el ejemplo de A-Frame -->
    <a-scene 
        background="color: #001122"
        fog="type: exponential; color: #001122; density: 0.1"
        vr-mode-ui="enabled: true">
        
        <!-- Assets -->
        <a-assets>
            <!-- Materiales m√°s bonitos -->
            <a-mixin id="node-material" 
                     material="color: #ff4444; metalness: 0.8; roughness: 0.2; emissive: #330000"></a-mixin>
            <a-mixin id="line-material" 
                     material="color: #00ffaa; metalness: 0.5; roughness: 0.3; emissive: #002200"></a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff" intensity="0.8"></a-light>
        <a-light type="point" position="0 10 0" color="#00ffaa" intensity="0.5"></a-light>

        <!-- Ground -->
        <a-plane 
            position="0 -2 0" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            color="#003366" 
            material="metalness: 0.8; roughness: 0.4">
        </a-plane>

        <!-- Grid pattern on ground -->
        <a-plane 
            position="0 -1.99 0" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            material="src: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICA8cGF0aCBkPSJNIDEwIDAgTCAwIDAgMCAxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA2NmFhIiBzdHJva2Utd2lkdGg9IjAuNSIvPgogICAgPC9wYXR0ZXJuPgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+Cjwvc3ZnPg==; transparent: true; opacity: 0.6">
        </a-plane>

        <!-- Sky -->
        <a-sky color="#001122"></a-sky>

        <!-- Camera with controls like A-Frame example -->
        <a-entity id="rig" position="0 2 4">
            <a-camera 
                id="camera"
                look-controls="pointerLockEnabled: false"
                wasd-controls="acceleration: 20"
                position="0 0 0">
                
                <!-- Cursor for interactions -->
                <a-cursor 
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                    animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: #00ffaa; shader: flat"
                    raycaster="objects: .clickable">
                </a-cursor>
            </a-camera>
        </a-entity>

        <!-- Structure Container -->
        <a-entity id="structure-container" position="0 0 0"></a-entity>

        <!-- Decorative elements -->
        <a-torus 
            position="-10 3 -10" 
            color="#0066aa" 
            animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"
            material="metalness: 0.8; roughness: 0.2">
        </a-torus>
        
        <a-icosahedron 
            position="10 4 -8" 
            color="#aa6600" 
            animation="property: rotation; to: 360 360 0; loop: true; dur: 15000"
            material="metalness: 0.6; roughness: 0.4">
        </a-icosahedron>
    </a-scene>

    <script>
        // ========== DIAGN√ìSTICO Y DEBUG ==========
        let errorCount = 0;
        let debugLog = [];
        
        // Capturar errores
        window.addEventListener('error', function(e) {
            errorCount++;
            debugLog.push('ERROR: ' + e.message);
            document.getElementById('error-count').textContent = errorCount;
            console.error('Error capturado:', e);
        });
        
        // Log personalizado
        function debugLogMessage(message) {
            debugLog.push(new Date().toLocaleTimeString() + ': ' + message);
            console.log('DEBUG:', message);
        }
        
        debugLogMessage('üöÄ P√°gina iniciada');
        
        // Detectar informaci√≥n del dispositivo
        function detectDevice() {
            const userAgent = navigator.userAgent;
            let deviceInfo = '';
            
            if (/iPhone/i.test(userAgent)) {
                deviceInfo = 'iPhone';
            } else if (/iPad/i.test(userAgent)) {
                deviceInfo = 'iPad';
            } else if (/Android/i.test(userAgent)) {
                deviceInfo = 'Android';
            } else if (/Windows/i.test(userAgent)) {
                deviceInfo = 'Windows';
            } else if (/Mac/i.test(userAgent)) {
                deviceInfo = 'Mac';
            } else {
                deviceInfo = 'Desconocido';
            }
            
            if (/Chrome/i.test(userAgent)) {
                deviceInfo += ' - Chrome';
            } else if (/Safari/i.test(userAgent)) {
                deviceInfo += ' - Safari';
            } else if (/Firefox/i.test(userAgent)) {
                deviceInfo += ' - Firefox';
            }
            
            return deviceInfo;
        }
        
        // Verificar si A-Frame carg√≥
        function checkAFrame() {
            if (typeof AFRAME !== 'undefined') {
                document.getElementById('aframe-status').textContent = '‚úÖ Cargado';
                debugLogMessage('‚úÖ A-Frame cargado correctamente');
                return true;
            } else {
                document.getElementById('aframe-status').textContent = '‚ùå Error';
                debugLogMessage('‚ùå A-Frame NO cargado');
                return false;
            }
        }
        
        // Test b√°sico
        function runBasicTest() {
            debugLogMessage('üß™ Ejecutando test b√°sico...');
            
            try {
                // Test 1: Crear elemento b√°sico
                const testBox = document.createElement('a-box');
                testBox.setAttribute('position', '0 2 -5');
                testBox.setAttribute('color', 'red');
                testBox.setAttribute('id', 'test-box');
                
                const scene = document.querySelector('a-scene');
                if (scene) {
                    scene.appendChild(testBox);
                    debugLogMessage('‚úÖ Test box creado');
                    
                    // Remover despu√©s de 3 segundos
                    setTimeout(() => {
                        if (document.getElementById('test-box')) {
                            testBox.remove();
                            debugLogMessage('‚úÖ Test box removido');
                        }
                    }, 3000);
                    
                    alert('‚úÖ TEST PAS√ì! A-Frame funciona en tu dispositivo.');
                } else {
                    throw new Error('No se encontr√≥ a-scene');
                }
                
            } catch (error) {
                debugLogMessage('‚ùå Test fall√≥: ' + error.message);
                alert('‚ùå TEST FALL√ì: ' + error.message);
            }
        }
        
        // Manager simplificado para debug
        class DebugStructureManager {
            constructor() {
                debugLogMessage('üèóÔ∏è Inicializando DebugStructureManager...');
                this.structureGenerated = false;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateUI();
                debugLogMessage('‚úÖ Manager inicializado');
            }
            
            setupEventListeners() {
                debugLogMessage('üîó Configurando event listeners...');
                
                document.getElementById('test-btn').addEventListener('click', () => {
                    debugLogMessage('üß™ Bot√≥n test presionado');
                    runBasicTest();
                });
                
                document.getElementById('spawn-btn').addEventListener('click', () => {
                    debugLogMessage('üèóÔ∏è Bot√≥n spawn presionado');
                    this.createSimpleStructure();
                });
                
                document.getElementById('info-btn').addEventListener('click', () => {
                    this.showDetailedInfo();
                });
            }
            
            createSimpleStructure() {
                try {
                    debugLogMessage('üèóÔ∏è Creando estructura simple...');
                    
                    const scene = document.querySelector('a-scene');
                    if (!scene) {
                        throw new Error('No se encontr√≥ a-scene');
                    }
                    
                    // Limpiar estructura anterior
                    const existing = document.getElementById('debug-structure');
                    if (existing) {
                        existing.remove();
                    }
                    
                    // Crear contenedor
                    const container = document.createElement('a-entity');
                    container.setAttribute('id', 'debug-structure');
                    
                    // Crear nodos simples
                    const positions = [
                        '0 1 -3',
                        '1 2 -3', 
                        '2 1 -3',
                        '1 0 -3'
                    ];
                    
                    positions.forEach((pos, index) => {
                        const sphere = document.createElement('a-sphere');
                        sphere.setAttribute('position', pos);
                        sphere.setAttribute('radius', '0.1');
                        sphere.setAttribute('color', '#ff4444');
                        sphere.setAttribute('id', `debug-node-${index}`);
                        container.appendChild(sphere);
                        
                        debugLogMessage(`‚úÖ Nodo ${index + 1} creado en ${pos}`);
                    });
                    
                    scene.appendChild(container);
                    this.structureGenerated = true;
                    this.updateUI();
                    
                    debugLogMessage('‚úÖ Estructura simple creada exitosamente');
                    alert('‚úÖ Estructura creada! Deber√≠as ver 4 esferas rojas.');
                    
                } catch (error) {
                    debugLogMessage('‚ùå Error creando estructura: ' + error.message);
                    alert('‚ùå Error: ' + error.message);
                }
            }
            
            showDetailedInfo() {
                const info = `
üîç INFORMACI√ìN DETALLADA

üì± Dispositivo: ${detectDevice()}
üìä A-Frame: ${typeof AFRAME !== 'undefined' ? 'Cargado' : 'No cargado'}
üåê WebGL: ${this.checkWebGL()}
üìè Pantalla: ${window.innerWidth}x${window.innerHeight}
‚ö†Ô∏è Errores: ${errorCount}

üîß LOG RECIENTE:
${debugLog.slice(-5).join('\n')}

üìã SOPORTE:
‚Ä¢ WebGL: ${this.checkWebGL() ? '‚úÖ' : '‚ùå'}
‚Ä¢ getUserMedia: ${navigator.mediaDevices ? '‚úÖ' : '‚ùå'}
‚Ä¢ Touch: ${'ontouchstart' in window ? '‚úÖ' : '‚ùå'}
                `;
                alert(info);
            }
            
            checkWebGL() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
                } catch (e) {
                    return false;
                }
            }
            
            updateUI() {
                document.getElementById('browser-info').textContent = detectDevice();
                document.getElementById('structure-status').textContent = 
                    this.structureGenerated ? '‚úÖ Creada' : 'No generada';
            }
        }
        
        // ========== INICIALIZACI√ìN ==========
        debugLogMessage('üìã Configurando inicializaci√≥n...');
        
        document.addEventListener('DOMContentLoaded', () => {
            debugLogMessage('üìÑ DOM cargado');
            
            // Actualizar info del dispositivo inmediatamente
            document.getElementById('browser-info').textContent = detectDevice();
            
            // Esperar a que A-Frame cargue
            const waitForAFrame = setInterval(() => {
                if (checkAFrame()) {
                    clearInterval(waitForAFrame);
                    debugLogMessage('üé¨ Inicializando scene...');
                    
                    const scene = document.querySelector('a-scene');
                    if (scene.hasLoaded) {
                        debugLogMessage('üé¨ Scene ya cargada');
                        new DebugStructureManager();
                    } else {
                        scene.addEventListener('loaded', () => {
                            debugLogMessage('üé¨ Scene cargada (evento)');
                            new DebugStructureManager();
                        });
                    }
                }
            }, 500);
            
            // Timeout de seguridad
            setTimeout(() => {
                if (typeof AFRAME === 'undefined') {
                    debugLogMessage('‚è∞ Timeout - A-Frame no carg√≥');
                    document.getElementById('aframe-status').textContent = '‚è∞ Timeout';
                    alert('‚ùå A-Frame no pudo cargar. Verifica tu conexi√≥n a internet.');
                }
            }, 10000);
        });
        
        debugLogMessage('üèÅ Script cargado completamente');
    </script>
</body>
</html>
