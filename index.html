<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Debug - Test de C√°mara</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #000;
        color: white;
      }
      
      #debug {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(0,0,0,0.9);
        color: #00ff00;
        padding: 15px;
        border-radius: 10px;
        z-index: 9999;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }
      
      #video {
        width: 100%;
        height: 60vh;
        background: #333;
        border-radius: 10px;
        margin: 20px 0;
      }
      
      .step {
        background: #333;
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        border-left: 4px solid #4CC3D9;
      }
      
      .success {
        border-left-color: #00ff00;
        background: #1a4a1a;
      }
      
      .error {
        border-left-color: #ff0000;
        background: #4a1a1a;
      }
      
      button {
        background: #4CC3D9;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 5px;
        font-size: 16px;
        margin: 10px 5px;
        cursor: pointer;
      }
      
      button:hover {
        background: #369fb8;
      }
    </style>
  </head>
  <body>
    
    <div id="debug">
      <h3>üîç DIAGN√ìSTICO DE C√ÅMARA - PASO A PASO</h3>
      <div id="log">Iniciando diagn√≥stico...</div>
    </div>
    
    <div style="margin-top: 320px; text-align: center;">
      <h2>üì± Test de C√°mara Manual</h2>
      
      <video id="video" playsinline autoplay muted></video>
      
      <div>
        <button onclick="testCamera()">üé• Test C√°mara B√°sica</button>
        <button onclick="testAFrame()">üÖ∞Ô∏è Test A-Frame</button>
        <button onclick="testAR()">üîÆ Test AR.js</button>
        <button onclick="clearLog()">üßπ Limpiar Log</button>
      </div>
      
      <div style="margin-top: 20px;">
        <p><strong>Instrucciones:</strong></p>
        <p>1. Presiona "Test C√°mara B√°sica" primero</p>
        <p>2. Si funciona, prueba "Test A-Frame"</p>
        <p>3. Finalmente "Test AR.js"</p>
      </div>
    </div>

    <script>
      const log = document.getElementById('log');
      const video = document.getElementById('video');
      let step = 1;
      
      function addLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
        log.innerHTML += `<div class="step ${className}">
          [${timestamp}] Paso ${step++}: ${message}
        </div>`;
        log.scrollTop = log.scrollHeight;
        console.log(message);
      }
      
      function clearLog() {
        log.innerHTML = '<div>Log limpiado...</div>';
        step = 1;
      }
      
      // Test 1: C√°mara b√°sica HTML5
      async function testCamera() {
        addLog('üé• Iniciando test de c√°mara b√°sica...');
        
        try {
          // Verificar soporte
          if (!navigator.mediaDevices) {
            addLog('‚ùå navigator.mediaDevices no disponible', 'error');
            return;
          }
          
          addLog('‚úÖ navigator.mediaDevices disponible', 'success');
          
          // Solicitar permisos
          addLog('üìã Solicitando permisos de c√°mara...');
          
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { 
              facingMode: 'environment', // C√°mara trasera
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          });
          
          addLog('‚úÖ Permisos concedidos - Stream obtenido', 'success');
          
          // Mostrar video
          video.srcObject = stream;
          addLog('‚úÖ Video conectado al elemento HTML', 'success');
          
          video.onloadedmetadata = () => {
            addLog('‚úÖ Video cargado - ¬°C√°mara funcionando!', 'success');
          };
          
        } catch (error) {
          addLog(`‚ùå Error de c√°mara: ${error.name} - ${error.message}`, 'error');
          
          // Diagn√≥sticos espec√≠ficos
          if (error.name === 'NotAllowedError') {
            addLog('üí° SOLUCI√ìN: Permite acceso a la c√°mara en el navegador', 'error');
          } else if (error.name === 'NotFoundError') {
            addLog('üí° SOLUCI√ìN: No se encontr√≥ c√°mara - ¬øest√°s en m√≥vil?', 'error');
          } else if (error.name === 'NotSupportedError') {
            addLog('üí° SOLUCI√ìN: Necesitas HTTPS - ¬øusas GitHub Pages?', 'error');
          }
        }
      }
      
      // Test 2: A-Frame b√°sico
      function testAFrame() {
        addLog('üÖ∞Ô∏è Cargando A-Frame...');
        
        const script = document.createElement('script');
        script.src = 'https://aframe.io/releases/1.4.0/aframe.min.js';
        
        script.onload = () => {
          addLog('‚úÖ A-Frame cargado correctamente', 'success');
          
          // Crear escena b√°sica
          const scene = document.createElement('a-scene');
          scene.setAttribute('embedded', '');
          scene.setAttribute('style', 'height: 200px; width: 100%;');
          scene.innerHTML = `
            <a-box position="0 1 -3" color="#4CC3D9"></a-box>
            <a-sphere position="2 1 -5" color="#EF2D5E"></a-sphere>
            <a-sky color="#ECECEC"></a-sky>
          `;
          
          document.body.appendChild(scene);
          addLog('‚úÖ Escena A-Frame creada', 'success');
        };
        
        script.onerror = () => {
          addLog('‚ùå Error cargando A-Frame', 'error');
        };
        
        document.head.appendChild(script);
      }
      
      // Test 3: AR.js
      function testAR() {
        addLog('üîÆ Cargando AR.js...');
        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js';
        
        script.onload = () => {
          addLog('‚úÖ AR.js cargado correctamente', 'success');
          
          // Crear escena AR b√°sica
          const arScene = document.createElement('a-scene');
          arScene.setAttribute('arjs', 'sourceType: webcam; debugUIEnabled: false;');
          arScene.setAttribute('vr-mode-ui', 'enabled: false');
          arScene.setAttribute('embedded', '');
          arScene.setAttribute('style', 'height: 300px; width: 100%;');
          
          arScene.innerHTML = `
            <a-camera camera look-controls wasd-controls></a-camera>
          `;
          
          document.body.appendChild(arScene);
          addLog('‚úÖ Escena AR creada - comprueba si aparece video', 'success');
          
          // Listener para eventos AR
          arScene.addEventListener('loaded', () => {
            addLog('‚úÖ AR.js inicializado completamente', 'success');
          });
          
        };
        
        script.onerror = () => {
          addLog('‚ùå Error cargando AR.js', 'error');
        };
        
        document.head.appendChild(script);
      }
      
      // Informaci√≥n del sistema
      addLog(`üåç Navegador: ${navigator.userAgent}`);
      addLog(`üîí Protocolo: ${window.location.protocol}`);
      addLog(`üì± Es m√≥vil: ${/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}`);
      addLog(`üé• MediaDevices: ${!!navigator.mediaDevices}`);
      
      // Verificaci√≥n inicial
      if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
        addLog('‚ö†Ô∏è ADVERTENCIA: No usas HTTPS - la c√°mara puede no funcionar', 'error');
      } else {
        addLog('‚úÖ HTTPS detectado - protocolo correcto', 'success');
      }
      
    </script>
  </body>
</html>
