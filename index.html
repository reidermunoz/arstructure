<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello World AR ‚Ä¢ A-Frame</title>
    <meta name="description" content="Realidad Aumentada con A-Frame">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js versi√≥n estable -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        overflow: hidden;
      }
      
      #loadingScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-size: 18px;
        text-align: center;
      }
      
      #loadingScreen.hidden {
        display: none;
      }
      
      .loading-spinner {
        border: 4px solid #333;
        border-top: 4px solid #4CC3D9;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      #instructions {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 999;
        font-size: 16px;
        text-align: center;
      }
      
      #tapButton {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: #4CC3D9;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-size: 18px;
        z-index: 999;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      
      #tapButton:active {
        transform: translateX(-50%) scale(0.95);
      }
    </style>
  </head>
  <body>
    
    <!-- Pantalla de carga -->
    <div id="loadingScreen">
      <div class="loading-spinner"></div>
      <p>üé• Iniciando c√°mara...</p>
      <p>Por favor permite el acceso a la c√°mara</p>
      <small>Si no funciona, recarga la p√°gina</small>
    </div>

    <!-- Instrucciones -->
    <div id="instructions">
      üì± <strong>Apunta a una superficie plana y toca el bot√≥n para colocar objetos</strong>
    </div>
    
    <!-- Bot√≥n para colocar objetos -->
    <button id="tapButton" onclick="placeObjects()">
      üìç Colocar Objetos
    </button>

    <!-- Escena AR -->
    <a-scene
      id="arScene"
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; 
            sourceWidth: 1280; 
            sourceHeight: 960; 
            displayWidth: 1280; 
            displayHeight: 960;
            debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true; 
                colorManagement: true; 
                sortObjects: true; 
                antialias: true;"
      background="transparent"
      embedded
      style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;">
      
      <!-- Marcador invisible para AR -->
      <a-marker
        id="marker"
        type="pattern"
        preset="hiro"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;">
        
        <!-- Contenedor de objetos -->
        <a-entity id="objects" visible="false" position="0 0 0">
          
          <!-- Cubo azul -->
          <a-box 
            position="-0.5 0.2 0" 
            rotation="0 45 0" 
            scale="0.3 0.3 0.3"
            color="#4CC3D9" 
            shadow="cast: true; receive: true"
            animation="property: rotation; 
                       to: 0 405 0; 
                       loop: true; 
                       dur: 4000; 
                       easing: linear">
          </a-box>
          
          <!-- Esfera rosa -->
          <a-sphere 
            position="0 0.4 -0.5" 
            radius="0.2" 
            color="#EF2D5E" 
            shadow="cast: true; receive: true"
            animation="property: position; 
                       to: 0 0.8 -0.5; 
                       direction: alternate; 
                       loop: true; 
                       dur: 2000; 
                       easing: easeInOutSine">
          </a-sphere>
          
          <!-- Cilindro amarillo -->
          <a-cylinder 
            position="0.5 0.15 0" 
            radius="0.15" 
            height="0.4" 
            color="#FFC65D" 
            shadow="cast: true; receive: true"
            animation="property: scale; 
                       to: 1 1.5 1; 
                       direction: alternate; 
                       loop: true; 
                       dur: 3000; 
                       easing: easeInOutElastic">
          </a-cylinder>
          
          <!-- Plano verde base -->
          <a-plane 
            position="0 0 0" 
            rotation="-90 0 0" 
            width="2" 
            height="2" 
            color="#7BC8A4" 
            opacity="0.7"
            shadow="receive: true">
          </a-plane>
          
          <!-- Texto flotante -->
          <a-text 
            value="¬°Hola AR!" 
            position="0 1 0" 
            align="center" 
            color="#333333"
            scale="2 2 2"
            look-at="#arCamera"
            shader="msdf"
            font="roboto">
          </a-text>
          
        </a-entity>
        
      </a-marker>
      
      <!-- C√°mara AR -->
      <a-entity 
        id="arCamera"
        camera 
        look-controls="enabled: false"
        wasd-controls="enabled: false"
        cursor="rayOrigin: mouse">
      </a-entity>
      
      <!-- Luces -->
      <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
      <a-light type="directional" position="0 1 1" shadow="cast: true"></a-light>
      
    </a-scene>

    <script>
      let arReady = false;
      let objectsVisible = false;
      
      // Funci√≥n para colocar objetos
      function placeObjects() {
        const objects = document.querySelector('#objects');
        if (objects && arReady) {
          objects.setAttribute('visible', !objectsVisible);
          objectsVisible = !objectsVisible;
          
          const button = document.getElementById('tapButton');
          button.textContent = objectsVisible ? '‚ùå Ocultar Objetos' : 'üìç Colocar Objetos';
          
          if (objectsVisible) {
            document.getElementById('instructions').innerHTML = 
              'üéâ <strong>¬°Objetos colocados!</strong> Mu√©vete para verlos desde diferentes √°ngulos';
          } else {
            document.getElementById('instructions').innerHTML = 
              'üì± <strong>Apunta a una superficie plana y toca el bot√≥n para colocar objetos</strong>';
          }
        }
      }
      
      // Detectar cuando AR est√° listo
      document.querySelector('a-scene').addEventListener('loaded', function () {
        console.log('A-Frame cargado');
        setTimeout(() => {
          arReady = true;
          document.getElementById('loadingScreen').classList.add('hidden');
          console.log('AR listo para usar');
        }, 3000); // Dar tiempo a que se inicialice la c√°mara
      });
      
      // Detectar errores
      window.addEventListener('error', function(e) {
        console.error('Error:', e.error);
        document.getElementById('loadingScreen').innerHTML = `
          <div style="color: #ff6b6b;">
            <h3>‚ùå Error de c√°mara</h3>
            <p>No se puede acceder a la c√°mara</p>
            <p><strong>Soluciones:</strong></p>
            <ul style="text-align: left; display: inline-block;">
              <li>Permite acceso a la c√°mara</li>
              <li>Usa HTTPS (GitHub Pages ‚úÖ)</li>
              <li>Prueba en Chrome/Safari m√≥vil</li>
              <li>Recarga la p√°gina</li>
            </ul>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4CC3D9; color: white; border: none; border-radius: 5px;">
              üîÑ Recargar P√°gina
            </button>
          </div>
        `;
      });
      
      // Detectar si la c√°mara se inicia
      navigator.mediaDevices?.getUserMedia({ video: true })
        .then(stream => {
          console.log('‚úÖ C√°mara accesible');
          stream.getTracks().forEach(track => track.stop()); // Parar el test
        })
        .catch(err => {
          console.error('‚ùå Error de c√°mara:', err);
          document.getElementById('loadingScreen').innerHTML = `
            <div style="color: #ff6b6b;">
              <h3>‚ùå No se puede acceder a la c√°mara</h3>
              <p><strong>Error:</strong> ${err.message}</p>
              <p><strong>Soluciones:</strong></p>
              <ul style="text-align: left; display: inline-block;">
                <li>Permite acceso a la c√°mara en el navegador</li>
                <li>Aseg√∫rate de usar HTTPS</li>
                <li>Prueba en Chrome o Safari m√≥vil</li>
                <li>Verifica que no haya otra app usando la c√°mara</li>
              </ul>
              <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4CC3D9; color: white; border: none; border-radius: 5px;">
                üîÑ Reintentar
              </button>
            </div>
          `;
        });
      
    </script>
  </body>
</html>
