<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR con A-Frame</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/AR.js/2.2.2/aframe-ar.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 12px;
            max-width: 300px;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 20px;
            z-index: 1000;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 0 5px;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="info">
        <strong>AR Demo</strong><br>
        Apunta tu cámara alrededor para ver los objetos 3D flotando en el espacio
    </div>
    
    <div class="controls">
        <button onclick="addRandomObject()">Añadir Objeto</button>
        <button onclick="clearObjects()">Limpiar</button>
    </div>

    <!-- Escena A-Frame con AR -->
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        gesture-detector
        id="scene">
        
        <!-- Assets -->
        <a-assets>
            <a-mixin id="cube-mixin" 
                     geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5"
                     material="color: #ff6b6b; opacity: 0.8"
                     animation="property: rotation; to: 360 360 360; loop: true; dur: 5000">
            </a-mixin>
            
            <a-mixin id="sphere-mixin"
                     geometry="primitive: sphere; radius: 0.3"
                     material="color: #4ecdc4; opacity: 0.8"
                     animation="property: position; to: 0 2 0; direction: alternate; loop: true; dur: 2000">
            </a-mixin>
        </a-assets>
        
        <!-- Objetos 3D iniciales -->
        <a-box 
            position="0 1 -3" 
            mixin="cube-mixin"
            gesture-handler>
        </a-box>
        
        <a-sphere 
            position="2 1.5 -5" 
            mixin="sphere-mixin"
            gesture-handler>
        </a-sphere>
        
        <a-cylinder 
            position="-2 1 -4" 
            radius="0.3" 
            height="1" 
            color="#feca57"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
            gesture-handler>
        </a-cylinder>
        
        <a-text 
            position="0 3 -2" 
            value="¡Realidad Aumentada!" 
            color="#ffffff" 
            align="center"
            animation="property: scale; to: 1.2 1.2 1.2; direction: alternate; loop: true; dur: 1500">
        </a-text>
        
        <!-- Luces -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 1 1" color="#ffffff"></a-light>
        
        <!-- Cámara -->
        <a-camera
            id="camera"
            position="0 0 0"
            look-controls-enabled="false"
            wasd-controls-enabled="false"
            cursor="rayOrigin: mouse">
        </a-camera>
    </a-scene>

    <script>
        // Component para manejar gestos
        AFRAME.registerComponent('gesture-handler', {
            init: function () {
                this.el.addEventListener('click', () => {
                    // Cambiar color al tocar
                    const colors = ['#ff6b6b', '#4ecdc4', '#feca57', '#a55eea', '#26de81', '#fd79a8'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    this.el.setAttribute('material', 'color', randomColor);
                    
                    // Efecto de escala
                    this.el.setAttribute('animation__scale', {
                        property: 'scale',
                        to: '1.5 1.5 1.5',
                        dur: 200,
                        direction: 'alternate',
                        easing: 'easeInOutQuad'
                    });
                });
            }
        });

        // Component detector de gestos
        AFRAME.registerComponent('gesture-detector', {
            init: function () {
                this.onTouchStart = this.onTouchStart.bind(this);
                this.onTouchEnd = this.onTouchEnd.bind(this);
                this.el.addEventListener('touchstart', this.onTouchStart);
                this.el.addEventListener('touchend', this.onTouchEnd);
            },
            
            onTouchStart: function (event) {
                this.touchStarted = true;
            },
            
            onTouchEnd: function (event) {
                if (this.touchStarted) {
                    this.touchStarted = false;
                    // Aquí puedes agregar más lógica de gestos
                }
            }
        });

        let objectCount = 0;

        // Función para añadir objetos aleatorios
        function addRandomObject() {
            const scene = document.querySelector('#scene');
            const shapes = ['box', 'sphere', 'cylinder', 'octahedron'];
            const colors = ['#ff6b6b', '#4ecdc4', '#feca57', '#a55eea', '#26de81', '#fd79a8'];
            
            const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const entity = document.createElement('a-entity');
            entity.setAttribute('id', `object-${objectCount++}`);
            entity.setAttribute('geometry', `primitive: ${randomShape}`);
            entity.setAttribute('material', `color: ${randomColor}; opacity: 0.8`);
            entity.setAttribute('position', {
                x: (Math.random() - 0.5) * 8,
                y: Math.random() * 3 + 0.5,
                z: -Math.random() * 5 - 2
            });
            entity.setAttribute('animation', {
                property: 'rotation',
                to: '360 360 360',
                loop: true,
                dur: Math.random() * 3000 + 2000
            });
            entity.setAttribute('gesture-handler', '');
            
            scene.appendChild(entity);
        }

        // Función para limpiar objetos
        function clearObjects() {
            const scene = document.querySelector('#scene');
            for (let i = 0; i < objectCount; i++) {
                const obj = scene.querySelector(`#object-${i}`);
                if (obj) {
                    scene.removeChild(obj);
                }
            }
            objectCount = 0;
        }

        // Detectar cuando la escena esté lista
        document.querySelector('#scene').addEventListener('loaded', () => {
            console.log('Escena AR cargada correctamente');
        });

        // Manejar errores de cámara
        window.addEventListener('load', () => {
            setTimeout(() => {
                const video = document.querySelector('video');
                if (video) {
                    video.addEventListener('loadeddata', () => {
                        console.log('Cámara iniciada correctamente');
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html>
