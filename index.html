<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Structure Viewer - Simple</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #ui-overlay {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 999;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            max-width: 280px;
            border: 2px solid #00ff88;
        }
        
        .control-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-buttons button {
            padding: 12px 16px;
            background: rgba(0, 150, 255, 0.9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 120px;
            transition: all 0.3s;
        }
        
        .control-buttons button:hover {
            background: rgba(0, 180, 255, 1);
            transform: scale(1.05);
        }
        
        .control-buttons button:disabled {
            background: rgba(100, 100, 100, 0.5);
            cursor: not-allowed;
            transform: none;
        }
        
        .control-buttons button.primary {
            background: rgba(0, 200, 100, 0.9);
        }
        
        .control-buttons button.primary:hover {
            background: rgba(0, 255, 120, 1);
        }
        
        .control-buttons button.danger {
            background: rgba(255, 80, 80, 0.9);
        }
        
        .control-buttons button.danger:hover {
            background: rgba(255, 100, 100, 1);
        }

        #instructions {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff88;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            text-align: center;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <h3 style="margin: 0 0 10px 0; color: #00ff88;">üèóÔ∏è AR Structure Viewer</h3>
        <div>üìä Status: <span id="status">Listo</span></div>
        <div>üè¢ Estructura: <span id="structure-status">No generada</span></div>
        <div>üìê Desplazamientos: <span id="displacement-status">Original</span></div>
        <div>üìè Escala: <span id="scale-value">0.2</span></div>
    </div>

    <!-- Instructions -->
    <div id="instructions">
        üéÆ Usa WASD para moverte | üñ±Ô∏è Arrastra para girar la vista
    </div>

    <!-- Control Buttons -->
    <div class="control-buttons">
        <button id="spawn-btn" class="primary">üèóÔ∏è Generar Estructura</button>
        <button id="toggle-displacement-btn" disabled>üìê Aplicar Desplazamientos</button>
        <button id="destroy-btn" class="danger" disabled>üóëÔ∏è Destruir</button>
        <button id="info-btn">‚ÑπÔ∏è Info</button>
    </div>

    <!-- A-Frame Scene - Simple como el ejemplo de A-Frame -->
    <a-scene 
        background="color: #001122"
        fog="type: exponential; color: #001122; density: 0.1"
        vr-mode-ui="enabled: true">
        
        <!-- Assets -->
        <a-assets>
            <!-- Materiales m√°s bonitos -->
            <a-mixin id="node-material" 
                     material="color: #ff4444; metalness: 0.8; roughness: 0.2; emissive: #330000"></a-mixin>
            <a-mixin id="line-material" 
                     material="color: #00ffaa; metalness: 0.5; roughness: 0.3; emissive: #002200"></a-mixin>
        </a-assets>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff" intensity="0.8"></a-light>
        <a-light type="point" position="0 10 0" color="#00ffaa" intensity="0.5"></a-light>

        <!-- Ground -->
        <a-plane 
            position="0 -2 0" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            color="#003366" 
            material="metalness: 0.8; roughness: 0.4">
        </a-plane>

        <!-- Grid pattern on ground -->
        <a-plane 
            position="0 -1.99 0" 
            rotation="-90 0 0" 
            width="20" 
            height="20" 
            material="src: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICA8cGF0aCBkPSJNIDEwIDAgTCAwIDAgMCAxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA2NmFhIiBzdHJva2Utd2lkdGg9IjAuNSIvPgogICAgPC9wYXR0ZXJuPgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+Cjwvc3ZnPg==; transparent: true; opacity: 0.6">
        </a-plane>

        <!-- Sky -->
        <a-sky color="#001122"></a-sky>

        <!-- Camera with controls like A-Frame example -->
        <a-entity id="rig" position="0 2 4">
            <a-camera 
                id="camera"
                look-controls="pointerLockEnabled: false"
                wasd-controls="acceleration: 20"
                position="0 0 0">
                
                <!-- Cursor for interactions -->
                <a-cursor 
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                    animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: #00ffaa; shader: flat"
                    raycaster="objects: .clickable">
                </a-cursor>
            </a-camera>
        </a-entity>

        <!-- Structure Container -->
        <a-entity id="structure-container" position="0 0 0"></a-entity>

        <!-- Decorative elements -->
        <a-torus 
            position="-10 3 -10" 
            color="#0066aa" 
            animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"
            material="metalness: 0.8; roughness: 0.2">
        </a-torus>
        
        <a-icosahedron 
            position="10 4 -8" 
            color="#aa6600" 
            animation="property: rotation; to: 360 360 0; loop: true; dur: 15000"
            material="metalness: 0.6; roughness: 0.4">
        </a-icosahedron>
    </a-scene>

    <script>
        // ========== SIMPLE STRUCTURE MANAGER ==========
        class SimpleStructureManager {
            constructor() {
                // Par√°metros b√°sicos
                this.Lv1 = 3.0;
                this.Lh1 = 4.0;
                this.structureScale = 0.3; // M√°s grande para mejor visibilidad
                
                // Estado
                this.structureGenerated = false;
                this.isDisplacementApplied = false;
                this.currentStructure = null;
                this.currentNodes = [];
                
                // Conectividad
                this.connections = [
                    [0, 1], [1, 2], [2, 3], [3, 4],
                    [1, 4], [4, 5], [4, 6], [6, 7]
                ];
                
                // Posiciones originales
                this.nodePositions = [];
                this.originalNodePositions = [];
                
                // Desplazamientos
                this.displacementScale = 500.0; // Reducido para mejor visualizaci√≥n
                this.nodeDisplacements = [
                    {x: 0, y: 0, z: 0},
                    {x: -0.000214334467084222, y: -2.92585497916779e-05, z: 0.000299282917049326},
                    {x: -4.51228548254704e-05, y: -5.91445463001043e-05, z: -0.00125414567113917},
                    {x: -5.26077882706616e-05, y: -7.62472910434113e-05, z: 0.00121519336768121},
                    {x: -0.000205459371218351, y: -4.61332875518377e-05, z: -0.000475039410395658},
                    {x: 0, y: 0, z: 0},
                    {x: -0.000209509318349148, y: -1.46081626564844e-05, z: 0.000595291931114151},
                    {x: 0, y: 0, z: 0}
                ];
                
                this.init();
            }
            
            init() {
                this.initializeNodePositions();
                this.setupEventListeners();
                this.updateUI();
                console.log('‚úÖ Simple Structure Manager inicializado');
            }
            
            initializeNodePositions() {
                const basePositions = [
                    {x: 0, y: 0, z: 0},
                    {x: 0, y: this.Lv1, z: 0},
                    {x: 0, y: this.Lv1 * 2, z: 0},
                    {x: this.Lh1, y: this.Lv1 * 2, z: 0},
                    {x: this.Lh1, y: this.Lv1, z: 0},
                    {x: this.Lh1, y: 0, z: 0},
                    {x: this.Lh1 * 2, y: this.Lv1, z: 0},
                    {x: this.Lh1 * 2, y: 0, z: 0}
                ];
                
                this.nodePositions = basePositions.map(pos => ({
                    x: pos.x * this.structureScale,
                    y: pos.y * this.structureScale,
                    z: pos.z * this.structureScale
                }));
                
                this.originalNodePositions = [...this.nodePositions];
                console.log('üìä Posiciones de nodos inicializadas');
            }
            
            setupEventListeners() {
                document.getElementById('spawn-btn').addEventListener('click', () => {
                    this.generateStructure();
                });
                
                document.getElementById('toggle-displacement-btn').addEventListener('click', () => {
                    this.toggleDisplacements();
                });
                
                document.getElementById('destroy-btn').addEventListener('click', () => {
                    this.destroyStructure();
                });
                
                document.getElementById('info-btn').addEventListener('click', () => {
                    this.showInfo();
                });
                
                // Click en estructura para regenerar
                const scene = document.querySelector('a-scene');
                scene.addEventListener('click', (event) => {
                    if (event.target.classList.contains('clickable') && !this.structureGenerated) {
                        this.generateStructure();
                    }
                });
            }
            
            generateStructure() {
                if (this.structureGenerated) {
                    this.destroyStructure();
                }
                
                console.log('üèóÔ∏è Generando estructura...');
                
                const container = document.querySelector('#structure-container');
                const structureEntity = document.createElement('a-entity');
                structureEntity.setAttribute('id', 'structure');
                structureEntity.setAttribute('position', '0 0 0');
                container.appendChild(structureEntity);
                
                this.currentStructure = structureEntity;
                this.currentNodes = [];
                
                // Crear nodos
                for (let i = 0; i < this.nodePositions.length; i++) {
                    const node = this.createNode(i, this.nodePositions[i]);
                    structureEntity.appendChild(node);
                    this.currentNodes.push(node);
                }
                
                // Crear l√≠neas
                for (let i = 0; i < this.connections.length; i++) {
                    const [nodeA, nodeB] = this.connections[i];
                    const line = this.createLine(
                        this.nodePositions[nodeA],
                        this.nodePositions[nodeB],
                        i + 1
                    );
                    structureEntity.appendChild(line);
                }
                
                this.structureGenerated = true;
                this.updateUI();
                console.log('‚úÖ Estructura generada exitosamente');
            }
            
            createNode(index, position) {
                const node = document.createElement('a-sphere');
                node.setAttribute('id', `node-${index + 1}`);
                node.setAttribute('position', position);
                node.setAttribute('radius', '0.08');
                node.setAttribute('class', 'clickable structure-node');
                node.setAttribute('material', 'color: #ff4444; metalness: 0.8; roughness: 0.2; emissive: #331100');
                node.setAttribute('animation__hover', 'property: scale; startEvents: mouseenter; to: 1.3 1.3 1.3; dur: 200');
                node.setAttribute('animation__leave', 'property: scale; startEvents: mouseleave; to: 1 1 1; dur: 200');
                
                // Texto del nodo
                const text = document.createElement('a-text');
                text.setAttribute('value', `${index + 1}`);
                text.setAttribute('position', '0 0.15 0');
                text.setAttribute('align', 'center');
                text.setAttribute('color', '#ffffff');
                text.setAttribute('scale', '2 2 2');
                node.appendChild(text);
                
                return node;
            }
            
            createLine(startPos, endPos, lineNumber) {
                const centerX = (startPos.x + endPos.x) / 2;
                const centerY = (startPos.y + endPos.y) / 2;
                const centerZ = (startPos.z + endPos.z) / 2;
                
                const dx = endPos.x - startPos.x;
                const dy = endPos.y - startPos.y;
                const dz = endPos.z - startPos.z;
                
                const length = Math.sqrt(dx * dx + dy * dy + dz * dz);
                const rotationY = Math.atan2(dx, dz) * (180 / Math.PI);
                const rotationZ = -Math.atan2(dy, Math.sqrt(dx * dx + dz * dz)) * (180 / Math.PI);
                
                const line = document.createElement('a-cylinder');
                line.setAttribute('id', `line-${lineNumber}`);
                line.setAttribute('radius', '0.015');
                line.setAttribute('height', length);
                line.setAttribute('position', {x: centerX, y: centerY, z: centerZ});
                line.setAttribute('rotation', {x: 0, y: rotationY, z: rotationZ});
                line.setAttribute('class', 'structure-line');
                line.setAttribute('material', 'color: #00ffaa; metalness: 0.6; roughness: 0.3; emissive: #002200');
                
                return line;
            }
            
            toggleDisplacements() {
                if (!this.structureGenerated) return;
                
                if (this.isDisplacementApplied) {
                    this.resetToOriginalPositions();
                } else {
                    this.applyDisplacements();
                }
                
                this.updateUI();
            }
            
            applyDisplacements() {
                console.log('üìê Aplicando desplazamientos...');
                
                for (let i = 0; i < this.nodeDisplacements.length; i++) {
                    if (this.currentNodes[i]) {
                        const displacement = {
                            x: this.nodeDisplacements[i].x * this.displacementScale * this.structureScale,
                            y: this.nodeDisplacements[i].y * this.displacementScale * this.structureScale,
                            z: 0
                        };
                        
                        const newPosition = {
                            x: this.originalNodePositions[i].x + displacement.x,
                            y: this.originalNodePositions[i].y + displacement.y,
                            z: this.originalNodePositions[i].z + displacement.z
                        };
                        
                        // Animaci√≥n suave
                        this.currentNodes[i].setAttribute('animation__displace', 
                            `property: position; to: ${newPosition.x} ${newPosition.y} ${newPosition.z}; dur: 1000; easing: easeInOutQuad`);
                    }
                }
                
                setTimeout(() => {
                    this.regenerateLines();
                }, 1000);
                
                this.isDisplacementApplied = true;
                console.log('‚úÖ Desplazamientos aplicados');
            }
            
            resetToOriginalPositions() {
                console.log('üîÑ Restaurando posiciones originales...');
                
                for (let i = 0; i < this.originalNodePositions.length; i++) {
                    if (this.currentNodes[i]) {
                        const pos = this.originalNodePositions[i];
                        this.currentNodes[i].setAttribute('animation__reset', 
                            `property: position; to: ${pos.x} ${pos.y} ${pos.z}; dur: 1000; easing: easeInOutQuad`);
                    }
                }
                
                setTimeout(() => {
                    this.regenerateLines();
                }, 1000);
                
                this.isDisplacementApplied = false;
                console.log('‚úÖ Posiciones restauradas');
            }
            
            regenerateLines() {
                if (!this.currentStructure) return;
                
                const existingLines = this.currentStructure.querySelectorAll('.structure-line');
                existingLines.forEach(line => line.remove());
                
                for (let i = 0; i < this.connections.length; i++) {
                    const [nodeA, nodeB] = this.connections[i];
                    const startPos = this.currentNodes[nodeA].getAttribute('position');
                    const endPos = this.currentNodes[nodeB].getAttribute('position');
                    
                    const line = this.createLine(startPos, endPos, i + 1);
                    this.currentStructure.appendChild(line);
                }
            }
            
            destroyStructure() {
                if (this.currentStructure) {
                    // Animaci√≥n de destrucci√≥n
                    const nodes = this.currentStructure.querySelectorAll('.structure-node');
                    nodes.forEach((node, index) => {
                        setTimeout(() => {
                            node.setAttribute('animation__destroy', 
                                'property: scale; to: 0 0 0; dur: 500; easing: easeInBack');
                        }, index * 100);
                    });
                    
                    setTimeout(() => {
                        this.currentStructure.remove();
                        this.structureGenerated = false;
                        this.isDisplacementApplied = false;
                        this.currentStructure = null;
                        this.currentNodes = [];
                        this.updateUI();
                        console.log('üóëÔ∏è Estructura destruida');
                    }, 1000);
                }
            }
            
            showInfo() {
                const info = `
üèóÔ∏è INFORMACI√ìN DE LA ESTRUCTURA

üìä Nodos: 8
üîó Elementos: 8 l√≠neas de conexi√≥n
üìê Escala: ${this.structureScale}
üìè Factor desplazamiento: ${this.displacementScale}

üéÆ CONTROLES:
‚Ä¢ WASD: Mover c√°mara
‚Ä¢ Mouse: Girar vista
‚Ä¢ VR: Compatible con dispositivos VR

üîß ESTADO ACTUAL:
‚Ä¢ Estructura: ${this.structureGenerated ? 'Generada' : 'No generada'}
‚Ä¢ Desplazamientos: ${this.isDisplacementApplied ? 'Aplicados' : 'Original'}

üì± Compatible con iPhone, Android, PC y VR!
                `;
                alert(info);
            }
            
            updateUI() {
                document.getElementById('status').textContent = 'Funcionando';
                document.getElementById('structure-status').textContent = 
                    this.structureGenerated ? 'Generada ‚úÖ' : 'No generada';
                document.getElementById('displacement-status').textContent = 
                    this.isDisplacementApplied ? 'Aplicados üìê' : 'Original';
                document.getElementById('scale-value').textContent = this.structureScale;
                
                const toggleBtn = document.getElementById('toggle-displacement-btn');
                const destroyBtn = document.getElementById('destroy-btn');
                
                toggleBtn.disabled = !this.structureGenerated;
                destroyBtn.disabled = !this.structureGenerated;
                
                if (this.structureGenerated) {
                    toggleBtn.textContent = this.isDisplacementApplied ? 
                        'üîÑ Reset a Original' : 'üìê Aplicar Desplazamientos';
                }
            }
        }
        
        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', () => {
            const scene = document.querySelector('a-scene');
            
            if (scene.hasLoaded) {
                new SimpleStructureManager();
            } else {
                scene.addEventListener('loaded', () => {
                    new SimpleStructureManager();
                });
            }
        });
    </script>
</body>
</html>
