<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Hello World ‚Ä¢ A-Frame</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.min.js"></script>
    
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      
      #instructions {
        position: fixed;
        top: 20px;
        left: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 999;
        text-align: center;
        font-size: 16px;
      }
      
      #placeButton {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: #4CC3D9;
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 50px;
        font-size: 18px;
        font-weight: bold;
        z-index: 999;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      }
      
      #placeButton:active {
        transform: translateX(-50%) scale(0.95);
      }
      
      #debug {
        position: fixed;
        bottom: 100px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        color: #00ff00;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        z-index: 999;
        max-width: 200px;
      }
    </style>
  </head>
  <body>
    
    <!-- Instrucciones -->
    <div id="instructions">
      üì± <strong>¬°C√°mara iniciada!</strong><br>
      Apunta a una superficie y presiona el bot√≥n para colocar objetos 3D
    </div>
    
    <!-- Bot√≥n para colocar objetos -->
    <button id="placeButton" onclick="toggleObjects()">
      üìç Colocar Objetos
    </button>
    
    <!-- Debug info -->
    <div id="debug">
      Estado: <span id="status">Iniciando...</span>
    </div>

    <!-- Escena A-Frame con AR -->
    <a-scene
      id="scene"
      arjs="sourceType: webcam; 
            sourceWidth: 1280; 
            sourceHeight: 960; 
            displayWidth: 1280; 
            displayHeight: 960;
            debugUIEnabled: false;
            detectionMode: mono_and_matrix;
            matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; 
                colorManagement: true; 
                antialias: true;"
      background="transparent"
      embedded
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
      
      <!-- C√°mara AR -->
      <a-camera
        id="camera" 
        camera
        look-controls="enabled: false"
        wasd-controls="enabled: false">
      </a-camera>
      
      <!-- Contenedor de objetos 3D -->
      <a-entity id="objects" visible="false" position="0 0 -2">
        
        <!-- Cubo azul animado -->
        <a-box 
          position="-1 0.5 0" 
          rotation="0 45 0" 
          scale="0.5 0.5 0.5"
          color="#4CC3D9" 
          animation="property: rotation; 
                     to: 0 405 0; 
                     loop: true; 
                     dur: 6000; 
                     easing: linear"
          shadow="cast: true">
        </a-box>
        
        <!-- Esfera rosa flotante -->
        <a-sphere 
          position="0 1 -0.5" 
          radius="0.3" 
          color="#EF2D5E" 
          animation="property: position; 
                     to: 0 1.8 -0.5; 
                     direction: alternate; 
                     loop: true; 
                     dur: 2500; 
                     easing: easeInOutSine"
          shadow="cast: true">
        </a-sphere>
        
        <!-- Cilindro amarillo -->
        <a-cylinder 
          position="1 0.3 0" 
          radius="0.25" 
          height="0.6" 
          color="#FFC65D" 
          animation="property: scale; 
                     to: 1 1.5 1; 
                     direction: alternate; 
                     loop: true; 
                     dur: 3000; 
                     easing: easeInOutElastic"
          shadow="cast: true">
        </a-cylinder>
        
        <!-- Plano base verde -->
        <a-plane 
          position="0 0 0" 
          rotation="-90 0 0" 
          width="3" 
          height="3" 
          color="#7BC8A4" 
          opacity="0.8"
          shadow="receive: true">
        </a-plane>
        
        <!-- Texto 3D -->
        <a-text 
          value="¬°HOLA AR!" 
          position="0 2 0" 
          align="center" 
          color="#ffffff"
          scale="1.5 1.5 1.5"
          shader="msdf"
          font="roboto"
          look-at="#camera">
        </a-text>
        
        <!-- Torus decorativo -->
        <a-torus 
          position="0 0.1 -1" 
          color="#FF6B6B" 
          radius="0.5" 
          radius-tubular="0.1"
          animation="property: rotation; 
                     to: 360 0 360; 
                     loop: true; 
                     dur: 8000; 
                     easing: linear">
        </a-torus>
        
      </a-entity>
      
      <!-- Iluminaci√≥n -->
      <a-light 
        type="ambient" 
        color="#404040" 
        intensity="0.6">
      </a-light>
      
      <a-light 
        type="directional" 
        position="2 4 2" 
        color="#ffffff" 
        intensity="0.8"
        shadow="cast: true; mapSize: 1024 1024;">
      </a-light>
      
      <a-light 
        type="point" 
        position="0 3 0" 
        color="#4CC3D9" 
        intensity="0.5">
      </a-light>
      
    </a-scene>

    <script>
      let objectsVisible = false;
      let arReady = false;
      
      const status = document.getElementById('status');
      const objects = document.getElementById('objects');
      const button = document.getElementById('placeButton');
      const instructions = document.getElementById('instructions');
      
      // Funci√≥n para alternar objetos
      function toggleObjects() {
        if (!arReady) {
          status.textContent = 'AR no est√° listo';
          return;
        }
        
        objectsVisible = !objectsVisible;
        objects.setAttribute('visible', objectsVisible);
        
        if (objectsVisible) {
          button.textContent = '‚ùå Ocultar Objetos';
          instructions.innerHTML = 'üéâ <strong>¬°Objetos colocados!</strong><br>Mu√©vete para verlos desde diferentes √°ngulos';
          status.textContent = 'Objetos visibles';
        } else {
          button.textContent = 'üìç Colocar Objetos';
          instructions.innerHTML = 'üì± <strong>¬°C√°mara iniciada!</strong><br>Apunta a una superficie y presiona el bot√≥n para colocar objetos 3D';
          status.textContent = 'Objetos ocultos';
        }
      }
      
      // Event listeners para AR
      const scene = document.getElementById('scene');
      
      scene.addEventListener('loaded', () => {
        console.log('‚úÖ A-Frame cargado');
        status.textContent = 'A-Frame listo';
      });
      
      // Cuando AR.js est√° completamente inicializado
      scene.addEventListener('arjs-video-loaded', () => {
        console.log('‚úÖ Video AR cargado');
        arReady = true;
        status.textContent = 'AR listo';
        instructions.innerHTML = '‚úÖ <strong>¬°AR funcionando!</strong><br>Ahora puedes colocar objetos 3D en el mundo real';
      });
      
      // Detectar errores
      scene.addEventListener('arjs-video-error', (e) => {
        console.error('‚ùå Error de video AR:', e);
        status.textContent = 'Error AR';
        instructions.innerHTML = '‚ùå <strong>Error de c√°mara</strong><br>Recarga la p√°gina e intenta de nuevo';
      });
      
      // Fallback: marcar como listo despu√©s de un tiempo
      setTimeout(() => {
        if (!arReady) {
          arReady = true;
          status.textContent = 'AR listo (fallback)';
          console.log('‚è∞ AR marcado como listo por timeout');
        }
      }, 5000);
      
      // Debug: informaci√≥n del sistema
      console.log('üåç User Agent:', navigator.userAgent);
      console.log('üîí Protocolo:', window.location.protocol);
      console.log('üì± Es m√≥vil:', /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
      
    </script>
  </body>
</html>
