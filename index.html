<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello World AR ‚Ä¢ A-Frame</title>
    <meta name="description" content="Realidad Aumentada con A-Frame - Escanea superficies para colocar objetos">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    
    <!-- AR.js para Realidad Aumentada -->
    <script src="https://cdn.jsdelivr.net/npm/ar.js@2.2.0/aframe/build/aframe-ar.min.js"></script>
    
    <!-- WebXR Polyfill para mayor compatibilidad -->
    <script src="https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.min.js"></script>
    
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
      }
      
      #instructions {
        position: fixed;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 999;
        font-size: 14px;
        text-align: center;
      }
      
      #instructions.hidden {
        display: none;
      }
      
      .tap-instruction {
        background: rgba(76, 195, 217, 0.9);
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Instrucciones para el usuario -->
    <div id="instructions">
      <div class="tap-instruction">
        üì± <strong>Instrucciones AR:</strong><br>
        1. Permite acceso a la c√°mara<br>
        2. Apunta a una superficie plana<br>
        3. <strong>Toca la pantalla</strong> para colocar objetos<br>
        4. Mu√©vete para ver desde diferentes √°ngulos
      </div>
      <button onclick="hideInstructions()" style="margin-top: 10px; padding: 8px 16px; background: #4CC3D9; color: white; border: none; border-radius: 5px;">
        ¬°Entendido!
      </button>
    </div>

    <!-- Escena AR -->
    <a-scene
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; 
            debugUIEnabled: false; 
            detectionMode: mono_and_matrix; 
            matrixCodeType: 3x3;
            trackingMethod: best;"
      renderer="logarithmicDepthBuffer: true; colorManagement: true;"
      ar-hit-test="target: #objects"
      shadow="type: pcfsoft"
      background="transparent">
      
      <!-- C√°mara AR -->
      <a-camera 
        id="camera"
        gps-camera="gpsMinDistance: 5"
        look-controls="enabled: false"
        wasd-controls="enabled: false"
        cursor="fuse: false; rayOrigin: mouse">
      </a-camera>
      
      <!-- Contenedor de objetos que se colocan al hacer tap -->
      <a-entity id="objects" visible="false">
        
        <!-- Cubo azul -->
        <a-box 
          id="box"
          position="-0.3 0.1 0" 
          rotation="0 45 0" 
          scale="0.2 0.2 0.2"
          color="#4CC3D9" 
          shadow="cast: true; receive: true"
          animation="property: rotation; 
                     to: 0 405 0; 
                     loop: true; 
                     dur: 4000; 
                     easing: linear">
        </a-box>
        
        <!-- Esfera rosa -->
        <a-sphere 
          id="sphere"
          position="0 0.15 -0.2" 
          radius="0.1" 
          color="#EF2D5E" 
          shadow="cast: true; receive: true"
          animation="property: position; 
                     to: 0 0.25 -0.2; 
                     direction: alternate; 
                     loop: true; 
                     dur: 2000; 
                     easing: easeInOutSine">
        </a-sphere>
        
        <!-- Cilindro amarillo -->
        <a-cylinder 
          id="cylinder"
          position="0.3 0.05 0" 
          radius="0.08" 
          height="0.2" 
          scale="1 1 1"
          color="#FFC65D" 
          shadow="cast: true; receive: true"
          animation="property: scale; 
                     to: 1 1.5 1; 
                     direction: alternate; 
                     loop: true; 
                     dur: 3000; 
                     easing: easeInOutElastic">
        </a-cylinder>
        
        <!-- Plano verde como base -->
        <a-plane 
          position="0 0 0" 
          rotation="-90 0 0" 
          width="0.8" 
          height="0.8" 
          color="#7BC8A4" 
          opacity="0.8"
          shadow="receive: true">
        </a-plane>
        
        <!-- Texto de bienvenida -->
        <a-text 
          value="¬°Hola Mundo AR!" 
          position="0 0.3 -0.1" 
          align="center" 
          color="#333333"
          scale="0.5 0.5 0.5"
          shader="msdf"
          font="roboto">
        </a-text>
      </a-entity>
      
      <!-- Iluminaci√≥n -->
      <a-light 
        type="ambient" 
        color="#404040" 
        intensity="0.5">
      </a-light>
      
      <a-light 
        type="directional" 
        position="1 2 1" 
        color="#ffffff" 
        intensity="0.8"
        shadow="cast: true">
      </a-light>
      
      <!-- Cursor para interacci√≥n -->
      <a-entity 
        id="cursor"
        cursor="rayOrigin: mouse"
        raycaster="objects: #objects">
      </a-entity>
      
    </a-scene>

    <script>
      let objectsPlaced = false;
      
      // Funci√≥n para ocultar instrucciones
      function hideInstructions() {
        document.getElementById('instructions').classList.add('hidden');
      }
      
      // Detectar cuando se puede colocar objetos (hit test)
      document.querySelector('a-scene').addEventListener('ar-hit-test-start', function (e) {
        console.log('AR Hit Test iniciado');
      });
      
      // Colocar objetos cuando se hace tap en una superficie
      document.querySelector('a-scene').addEventListener('ar-hit-test-select', function (e) {
        const objects = document.querySelector('#objects');
        
        if (!objectsPlaced) {
          // Colocar objetos en la posici√≥n detectada
          objects.setAttribute('visible', true);
          objects.setAttribute('position', e.detail.position);
          objectsPlaced = true;
          
          // Ocultar instrucciones
          setTimeout(() => {
            hideInstructions();
          }, 1000);
          
          console.log('Objetos colocados en:', e.detail.position);
        }
      });
      
      // Fallback: colocar objetos con tap manual si AR hit-test no funciona
      document.addEventListener('touchstart', function(e) {
        if (!objectsPlaced) {
          const objects = document.querySelector('#objects');
          objects.setAttribute('visible', true);
          objects.setAttribute('position', '0 0 -1');
          objectsPlaced = true;
          hideInstructions();
          console.log('Objetos colocados manualmente');
        }
      });
      
      // Manejar errores de AR
      document.querySelector('a-scene').addEventListener('ar-error', function (e) {
        console.error('Error de AR:', e.detail);
        alert('Error al iniciar AR. Aseg√∫rate de permitir acceso a la c√°mara.');
      });
      
      // Debug: mostrar cuando AR est√° listo
      document.querySelector('a-scene').addEventListener('loaded', function () {
        console.log('Escena AR cargada correctamente');
      });
    </script>
  </body>
</html>
